#include "./printf/libftprintf.h"

static int return_type(char end);
static void test_flag1(int i, int type, char end);
static char *compose_flag(int i, char end);
static void print_val(int type, int v);
static int count_astrsks(char *flg);
static void print_test(int (*print_func)(const char *, ...), int ast, int type, char *flg, int v);
static void test_flag2(int i);

char *flgs[] = 
    {
        "",
        "#",
        "+",
        "-",
        " ",
        "0",
        ".",
        "#+",
        "#-",
        "# ",
        "#0",
        "#.",
        "+-",
        " +",
        "+0",
        "+.",
        " -",
        "-0",
        "-.",
        " 0",
        " .",
        "0.",
        "#+-",
        "# +",
        "#+0",
        "#+.",
        "# -",
        "#-0",
        "#-.",
        "# 0",
        "# .",
        "#0.",
        " +-",
        "+-0",
        "+-.",
        " +0",
        " +.",
        "+0.",
        " -0",
        " -.",
        "-0.",
        " 0.",
        "# +-",
        "#+-0",
        "#+-.",
        "# +0",
        "# +.",
        "#+0.",
        "# -0",
        "# -.",
        "#-0.",
        "# 0.",
        " +-0",
        " +-.",
        "+-0.",
        " +0.",
        " -0.",
        "# +-0",
        "# +-.",
        "#+-0.",
        "# +0.",
        "# -0.",
        " +-0.",
        "# +-0.",
        "10",
        "#10",
        "+10",
        "-10",
        " 10",
        "010",
        "10.",
        "#+10",
        "#-10",
        "# 10",
        "#010",
        "#10.",
        "+-10",
        " +10",
        "+010",
        "+10.",
        " -10",
        "-010",
        "-10.",
        " 010",
        " 10.",
        "010.",
        "#+-10",
        "# +10",
        "#+010",
        "#+10.",
        "# -10",
        "#-010",
        "#-10.",
        "# 010",
        "# 10.",
        "#010.",
        " +-10",
        "+-010",
        "+-10.",
        " +010",
        " +10.",
        "+010.",
        " -010",
        " -10.",
        "-010.",
        " 010.",
        "# +-10",
        "#+-010",
        "#+-10.",
        "# +010",
        "# +10.",
        "#+010.",
        "# -010",
        "# -10.",
        "#-010.",
        "# 010.",
        " +-010",
        " +-10.",
        "+-010.",
        " +010.",
        " -010.",
        "# +-010",
        "# +-10.",
        "#+-010.",
        "# +010.",
        "# -010.",
        " +-010.",
        "# +-010.",
        ".25",
        "#.25",
        "+.25",
        "-.25",
        " .25",
        "0.25",
        "#+.25",
        "#-.25",
        "# .25",
        "#0.25",
        "+-.25",
        " +.25",
        "+0.25",
        " -.25",
        "-0.25",
        " 0.25",
        "#+-.25",
        "# +.25",
        "#+0.25",
        "# -.25",
        "#-0.25",
        "# 0.25",
        " +-.25",
        "+-0.25",
        " +0.25",
        " -0.25",
        "# +-.25",
        "#+-0.25",
        "# +0.25",
        "# -0.25",
        " +-0.25",
        "# +-0.25",
        "10.25",
        "#10.25",
        "+10.25",
        "-10.25",
        " 10.25",
        "010.25",
        "#+10.25",
        "#-10.25",
        "# 10.25",
        "#010.25",
        "+-10.25",
        " +10.25",
        "+010.25",
        " -10.25",
        "-010.25",
        " 010.25",
        "#+-10.25",
        "# +10.25",
        "#+010.25",
        "# -10.25",
        "#-010.25",
        "# 010.25",
        " +-10.25",
        "+-010.25",
        " +010.25",
        " -010.25",
        "# +-10.25",
        "#+-010.25",
        "# +010.25",
        "# -010.25",
        " +-010.25",
        "# +-010.25",
        "14",
        "#14",
        "+14",
        "-14",
        " 14",
        "014",
        "14.",
        "#+14",
        "#-14",
        "# 14",
        "#014",
        "#14.",
        "+-14",
        " +14",
        "+014",
        "+14.",
        " -14",
        "-014",
        "-14.",
        " 014",
        " 14.",
        "014.",
        "#+-14",
        "# +14",
        "#+014",
        "#+14.",
        "# -14",
        "#-014",
        "#-14.",
        "# 014",
        "# 14.",
        "#014.",
        " +-14",
        "+-014",
        "+-14.",
        " +014",
        " +14.",
        "+014.",
        " -014",
        " -14.",
        "-014.",
        " 014.",
        "# +-14",
        "#+-014",
        "#+-14.",
        "# +014",
        "# +14.",
        "#+014.",
        "# -014",
        "# -14.",
        "#-014.",
        "# 014.",
        " +-014",
        " +-14.",
        "+-014.",
        " +014.",
        " -014.",
        "# +-014",
        "# +-14.",
        "#+-014.",
        "# +014.",
        "# -014.",
        " +-014.",
        "# +-014.",
        "14.25",
        "#14.25",
        "+14.25",
        "-14.25",
        " 14.25",
        "014.25",
        "#+14.25",
        "#-14.25",
        "# 14.25",
        "#014.25",
        "+-14.25",
        " +14.25",
        "+014.25",
        " -14.25",
        "-014.25",
        " 014.25",
        "#+-14.25",
        "# +14.25",
        "#+014.25",
        "# -14.25",
        "#-014.25",
        "# 014.25",
        " +-14.25",
        "+-014.25",
        " +014.25",
        " -014.25",
        "# +-14.25",
        "#+-014.25",
        "# +014.25",
        "# -014.25",
        " +-014.25",
        "# +-014.25",
        "20",
        "#20",
        "+20",
        "-20",
        " 20",
        "020",
        "20.",
        "#+20",
        "#-20",
        "# 20",
        "#020",
        "#20.",
        "+-20",
        " +20",
        "+020",
        "+20.",
        " -20",
        "-020",
        "-20.",
        " 020",
        " 20.",
        "020.",
        "#+-20",
        "# +20",
        "#+020",
        "#+20.",
        "# -20",
        "#-020",
        "#-20.",
        "# 020",
        "# 20.",
        "#020.",
        " +-20",
        "+-020",
        "+-20.",
        " +020",
        " +20.",
        "+020.",
        " -020",
        " -20.",
        "-020.",
        " 020.",
        "# +-20",
        "#+-020",
        "#+-20.",
        "# +020",
        "# +20.",
        "#+020.",
        "# -020",
        "# -20.",
        "#-020.",
        "# 020.",
        " +-020",
        " +-20.",
        "+-020.",
        " +020.",
        " -020.",
        "# +-020",
        "# +-20.",
        "#+-020.",
        "# +020.",
        "# -020.",
        " +-020.",
        "# +-020.",
        "20.25",
        "#20.25",
        "+20.25",
        "-20.25",
        " 20.25",
        "020.25",
        "#+20.25",
        "#-20.25",
        "# 20.25",
        "#020.25",
        "+-20.25",
        " +20.25",
        "+020.25",
        " -20.25",
        "-020.25",
        " 020.25",
        "#+-20.25",
        "# +20.25",
        "#+020.25",
        "# -20.25",
        "#-020.25",
        "# 020.25",
        " +-20.25",
        "+-020.25",
        " +020.25",
        " -020.25",
        "# +-20.25",
        "#+-020.25",
        "# +020.25",
        "# -020.25",
        " +-020.25",
        "# +-020.25",
        ".12",
        "#.12",
        "+.12",
        "-.12",
        " .12",
        "0.12",
        "#+.12",
        "#-.12",
        "# .12",
        "#0.12",
        "+-.12",
        " +.12",
        "+0.12",
        " -.12",
        "-0.12",
        " 0.12",
        "#+-.12",
        "# +.12",
        "#+0.12",
        "# -.12",
        "#-0.12",
        "# 0.12",
        " +-.12",
        "+-0.12",
        " +0.12",
        " -0.12",
        "# +-.12",
        "#+-0.12",
        "# +0.12",
        "# -0.12",
        " +-0.12",
        "# +-0.12",
        "10.12",
        "#10.12",
        "+10.12",
        "-10.12",
        " 10.12",
        "010.12",
        "#+10.12",
        "#-10.12",
        "# 10.12",
        "#010.12",
        "+-10.12",
        " +10.12",
        "+010.12",
        " -10.12",
        "-010.12",
        " 010.12",
        "#+-10.12",
        "# +10.12",
        "#+010.12",
        "# -10.12",
        "#-010.12",
        "# 010.12",
        " +-10.12",
        "+-010.12",
        " +010.12",
        " -010.12",
        "# +-10.12",
        "#+-010.12",
        "# +010.12",
        "# -010.12",
        " +-010.12",
        "# +-010.12",
        "14.12",
        "#14.12",
        "+14.12",
        "-14.12",
        " 14.12",
        "014.12",
        "#+14.12",
        "#-14.12",
        "# 14.12",
        "#014.12",
        "+-14.12",
        " +14.12",
        "+014.12",
        " -14.12",
        "-014.12",
        " 014.12",
        "#+-14.12",
        "# +14.12",
        "#+014.12",
        "# -14.12",
        "#-014.12",
        "# 014.12",
        " +-14.12",
        "+-014.12",
        " +014.12",
        " -014.12",
        "# +-14.12",
        "#+-014.12",
        "# +014.12",
        "# -014.12",
        " +-014.12",
        "# +-014.12",
        "20.12",
        "#20.12",
        "+20.12",
        "-20.12",
        " 20.12",
        "020.12",
        "#+20.12",
        "#-20.12",
        "# 20.12",
        "#020.12",
        "+-20.12",
        " +20.12",
        "+020.12",
        " -20.12",
        "-020.12",
        " 020.12",
        "#+-20.12",
        "# +20.12",
        "#+020.12",
        "# -20.12",
        "#-020.12",
        "# 020.12",
        " +-20.12",
        "+-020.12",
        " +020.12",
        " -020.12",
        "# +-20.12",
        "#+-020.12",
        "# +020.12",
        "# -020.12",
        " +-020.12",
        "# +-020.12",
        ".20",
        "#.20",
        "+.20",
        "-.20",
        " .20",
        "0.20",
        "#+.20",
        "#-.20",
        "# .20",
        "#0.20",
        "+-.20",
        " +.20",
        "+0.20",
        " -.20",
        "-0.20",
        " 0.20",
        "#+-.20",
        "# +.20",
        "#+0.20",
        "# -.20",
        "#-0.20",
        "# 0.20",
        " +-.20",
        "+-0.20",
        " +0.20",
        " -0.20",
        "# +-.20",
        "#+-0.20",
        "# +0.20",
        "# -0.20",
        " +-0.20",
        "# +-0.20",
        "10.20",
        "#10.20",
        "+10.20",
        "-10.20",
        " 10.20",
        "010.20",
        "#+10.20",
        "#-10.20",
        "# 10.20",
        "#010.20",
        "+-10.20",
        " +10.20",
        "+010.20",
        " -10.20",
        "-010.20",
        " 010.20",
        "#+-10.20",
        "# +10.20",
        "#+010.20",
        "# -10.20",
        "#-010.20",
        "# 010.20",
        " +-10.20",
        "+-010.20",
        " +010.20",
        " -010.20",
        "# +-10.20",
        "#+-010.20",
        "# +010.20",
        "# -010.20",
        " +-010.20",
        "# +-010.20",
        "14.20",
        "#14.20",
        "+14.20",
        "-14.20",
        " 14.20",
        "014.20",
        "#+14.20",
        "#-14.20",
        "# 14.20",
        "#014.20",
        "+-14.20",
        " +14.20",
        "+014.20",
        " -14.20",
        "-014.20",
        " 014.20",
        "#+-14.20",
        "# +14.20",
        "#+014.20",
        "# -14.20",
        "#-014.20",
        "# 014.20",
        " +-14.20",
        "+-014.20",
        " +014.20",
        " -014.20",
        "# +-14.20",
        "#+-014.20",
        "# +014.20",
        "# -014.20",
        " +-014.20",
        "# +-014.20",
        "20.20",
        "#20.20",
        "+20.20",
        "-20.20",
        " 20.20",
        "020.20",
        "#+20.20",
        "#-20.20",
        "# 20.20",
        "#020.20",
        "+-20.20",
        " +20.20",
        "+020.20",
        " -20.20",
        "-020.20",
        " 020.20",
        "#+-20.20",
        "# +20.20",
        "#+020.20",
        "# -20.20",
        "#-020.20",
        "# 020.20",
        " +-20.20",
        "+-020.20",
        " +020.20",
        " -020.20",
        "# +-20.20",
        "#+-020.20",
        "# +020.20",
        "# -020.20",
        " +-020.20",
        "# +-020.20",
        "$"
    };
char *flgs1[] = 
{
    "+-*.*",
    "# -.*",
    "#0*",
    "-0*",
    "+0*",
    "+#0*",
    "#0-*.*",
    "+-*0.*",
    "+-*.*",
    "+#-*.*",
    "0-+*.*",
    "#0-*.*",
    "$"
};
char *flgs2[] = 
    {
        "%2147483648.2147483648d",
        "%2147483649.2147483649d",
        "%4294967294.4294967294d",
        "%4294967295.4294967295d",
        "%*.*d",
        "%",
        "%%%",
        "%%%%",
        "% % %",
        "%#35%",
        "% 0+*k",
        "% -.*k",
        "%.5",
        "%10",
        "$"
    };
static int arg1[][2] = {{0, 0}, {10, 10}, {-10, -10}, {7, 7}, {3, 3}, {3, 20}, {20, 3}, {20, 14}, {14, 20}, {10, -10}, {101,0}};
static char ends[] = {'c','s','d','i','u','x','X','p','%','t','k','\0','$'};
static char *svals[] = {"42 Berlin Coding Academy", "R", NULL, "", "\0", "$"};
static char cvals[] = {'a', 64, '$'};
static long dvals[] = {42, 1, 0, -1, -1547, 2147483647, -2147483648, 2147483650, -2147483650, 4294967295, 4294967296, 4294967298, '$'};

int main()
{
    
    if (false)
    {
                write(1, "\"", 1);
        ft_printf("%#x", 4294967296);
                write(1, "\"\n", 2);
                write(1, "\"", 1);
        printf("%#x", 4294967296);
                fflush(stdout);
                write(1, "\"\n\n", 3);
        return 0;
    }
    
    int type;       

    for (int y = 0; ends[y] != '$'; y++)
    {
        type = return_type(ends[y]);
        for (int i = 0; flgs[i][0] != '$'; i++)
        {
            test_flag1(i, type, ends[y]);
        }
        for (int i = 0; flgs1[i][0] != '$'; i++)
        {
            test_flag1(i, type, ends[y]);
        }
    }
    for (int i = 0; flgs2[i][0] != '$'; i++)
    {
        test_flag2(i);
    }
    char *flg = "Mathematically, %.02d%% from %04d %c%c (%#x in hexadecimal) makes profit of %-+*d %-3c (%10s %-.3s %*.*s)";
    write(1, flg, ft_strlen((const char *)flg));
    write(1, "\n", 1);
    write(1, "\"", 1);
    ft_printf(flg, 5, 100, '$', '$', 100, 4, 20, '$', "twenty", "dollars", 10, 10, "of United States");
    write(1, "\"\n", 2);
    write(1, "\"", 1);
    printf(flg, 5, 100, '$', '$', 100, 4, 20, '$', "twenty", "dollars", 10, 10, "of United States");
    fflush(stdout);
    write(1, "\"\n\n", 3);
    return 0;
}

static int return_type(char end)
{
    int type;
    switch (end)
    {
        case 's':
        {
            type = 1;
            break;
        }
        case 'c':
        {
            type = 2;
            break;
        }
        case 'p':
        {
            type = 4;
            break;
        }
        case '%':
        {
            type = 2;
            break;
        }
        default:
        {
            type = 3;
            break;
        }
    }
    return type;
}

static void test_flag1(int i, int type, char end)
{
    char *flg = NULL;
    int ast;
    
    int v = 0;
    while (true)
    {
        if ((type == 1 || type == 4) && svals[v])
        {
            if (svals[v][0] == '$')
                break;
        }
        else if (type == 2 && cvals[v] == '$')
            break;
        else if (type == 3 && dvals[v] == '$')
            break;
        flg = compose_flag(i, end);
        write(1, flg, ft_strlen((const char *)flg));
        print_val(type, v);
        write(1, "\n", 1);
        write(1, "\"", 1);
        ast = count_astrsks(flg);
        print_test(ft_printf, ast, type, flg, v);
        write(1, "\"\n", 2);
        write(1, "\"", 1);
        print_test(printf, ast, type, flg, v);
        fflush(stdout);
        write(1, "\"\n\n", 3);
        free(flg);
        v++;
    }
}

static char *compose_flag(int i, char end)
{
    int len = ft_strlen(flgs[i]);
    char *flg = (char*)malloc(len + 3);
    if (flg == NULL)
        exit(-1);
    flg[0] = '%';
    flg[len + 1] = end;
    flg[len + 2] = '\0';
    for (int j = 1, z = 0; flgs[i][z] != '\0'; j++, z++)
    {
        flg[j] = flgs[i][z];
    }
    return (flg);
}

static void print_val(int type, int v)
{
    if (type == 1)
        printf(", %s", svals[v]);
    else if (type == 2)
        printf(", %c", cvals[v]);
    else if (type == 3)
        printf(", %d", dvals[v]);
    else if (type == 4)
        printf(", %p", svals[v]);
    fflush(stdout);
}

static void print_test(int (*print_func)(const char *, ...), int ast, int type, char *flg, int v)
{
    if (ast == 0)
    {
        if (type == 1 || type == 4)
            print_func(flg, svals[v]);
        else if (type == 2)
            print_func(flg, cvals[v]);
        else if (type == 3)
            print_func(flg, dvals[v]);
    }
    else if (ast == 1)
    {
        for (int n = 0; arg1[n][0] != 101; n++)
        {
            if (type == 1 || type == 4)
                print_func(flg, arg1[n][0], svals[v]);
            else if (type == 2)
                print_func(flg, arg1[n][0], cvals[v]);
            else if (type == 3)
                print_func(flg, arg1[n][0], dvals[v]);
            fflush(stdout);
            write(1, " | ", 3);
        }
    }    
    else
    {
        for (int n = 0; arg1[n][0] != 101; n++)
        {
            if (type == 1 || type == 4)
                print_func(flg, arg1[n][0], arg1[n][1], svals[v]);
            else if (type == 2)
                print_func(flg, arg1[n][0], arg1[n][1], cvals[v]);
            else if (type == 3)
                print_func(flg, arg1[n][0], arg1[n][1], dvals[v]);
            fflush(stdout);
            write(1, " | ", 3);
        }
    }
}

static int count_astrsks(char *flg)
{
    int ast = 0;

    for (int x = 0; flg[x] != '\0'; x++)
    {
        if (flg[x] == '*')
            ast++;
    }
    return (ast);
}

static void test_flag2(int i)
{
    int ast = count_astrsks(flgs2[i]);
    write(1, flgs2[i], ft_strlen((const char *)flgs2[i]));
    write(1, ", 42", 4);
    write(1, "\n", 1);
    write(1, "\"", 1);
    print_test(ft_printf, ast, 3, flgs2[i], 0);
    write(1, "\"\n", 2);
    write(1, "\"", 1);
    print_test(printf, ast, 3, flgs2[i], 0);
    fflush(stdout);
    write(1, "\"\n\n", 3);
    //"Mathematically, %.02d%% from %04d %c%c (%#x in hexadecimal) makes profit of %-+*d %-3c (%10s %-.3s %*.*s)"
}